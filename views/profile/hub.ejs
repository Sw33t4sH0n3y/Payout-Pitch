<%- include('../partials/header') %>

<main class="page-container">
    <div class="page-header">
        <h1>Your Hub</h1>
    </div>

    <div class="card hub-card">
        <form action="/hub?_method=PUT" method="POST">

            <section class="form-section">
                <h2 class="section-heading">User Deets</h2>

                <div class="form-group">
                    <label for="displayName">Display Name</label>
                    <input type="text" id="displayName" name="displayName" value="<%= user.displayName || '' %>" placeholder="Your display name">
                </div>

                <div class="form-group">
                    <label>Username</label>
                    <input type="text" value="<%= user.username %>" disabled>
                    <span class="form-hint">Username cannot be changed</span>
                </div>
            </section>

            <section class="form-section">
                <h2 class="section-heading">Your Roles</h2>
                <p class="section-description">Select all that apply</p>

                <div class="role-buttons">
                    <% Object.entries(ROLES).forEach(([key,role]) => { %>
                    <% const isChecked = user.roles && user.roles.includes(key); %>
                    <label class="role-checkbox">
                        <input type="checkbox" name="roles" value="<%= key %>" <%=isChecked ? 'checked' : '' %>>
                        <span class="role-btn <%= isChecked ? 'selected' : '' %>"> 
                            <%= role.icon %> <%= role.label %>
                        </span>
                    </label>
                    <% }) %>
                </div>
            </section>

                   <div class="role-fields role-fields-artist hidden" id="artist-fields">
        <h3>üé§ Artist Deets</h3>
                <div class="form-group">
                    <label for="stageName">Stage Name</label>
                    <input type="text" id="stageName" name="stageName" value="<%= user.stageName || '' %>">
                </div>

                <div class="form-group">
                    <label for="genre">Genre</label>
                    <input type="text" id="genre" name="genre" value="<%= user.genre || '' %>">
                </div>       
       </div>

            <div class="role-fields role-fields-producer hidden" id="producer-fields">
                <h3>üéõÔ∏è Producer Deets</h3>
                <div class="form-row">
                    <div class="form-group">
                <label for="producerTag">Producer Tag</label>
                    <input type="text" id="producerTag" name="producerTag" value="<%= user.producerTag || '' %>">
                </div>
                <div class="form-group">
                    <label for="daw">DAW</label>
                    <select id="daw" name="daw">
                        <option value="">Select DAW</option>
                        <% DAW_OPTIONS.forEach(d => { %>
                            <option value="<%= d %>"><%= d %></option>
                      <% }) %>
                    </select>
            </div>
        </div>    
    </div>

                <div class="role-fields role-fields-writer hidden" id="writer-fields">
                <h3>‚úçÔ∏è Writer Deets</h3>
                <div class="form-row">
                    <div class="form-group">
                <label for="writerPro">PRO</label>
                <select id="writerPro" name="writerPro">
                   <option value="">Select PRO</option>
                        <% PRO_OPTIONS.forEach(d => { %>
                            <option value="<%= d %>"><%= d %></option>
                      <% }) %>
                </select>
                </div>
                <div class="form-group">
                    <label for="writerIpi">IPI Number</label>
                    <input type="text" id="writerIpi" name="writerIpi" value="<%= user.stageName || '' %>">
                </div>
            </div>
        </div>

        <div class="role-fields role-fields-publisher hidden" id="publisher-fields">
                <h3>üìÑ Publisher Deets</h3>
                <div class="form-group">
                <label for="publishingCompany">Publishing Company</label>
                    <input type="text" id="publishingCompany" name="publishingCompany">
                </div>
                <div class="form-row">
                <div class="form-group">
                    <label for="publisherPro">Publisher PRO</label>
                    <select id="publisherPro" name="publisherPro">
                        <option value="">Select PRO</option>
                        <% PRO_OPTIONS.forEach(p => { %>
                            <option value="<%= p %>"><%= p %></option>
                      <% }) %>
                    </select>
            </div>
            <div class="form-group">
                <label for="publisherIpi">Publisher IPI</label>
                <input type="text" id="publisherIpi" name="publisherIpi">
            </div>
        </div>
    </div>

            <button type="submit" class="btn btn-primary btn-large btn-save">Save Hub</button>
        </form>
    </div>
</main>

<script>
    document.querySelectorAll('.role-checkbox input').forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            const role = this.value;
            const fields = document.querySelector(role + '-fields');
            const btn = this.nextElementSibling;

            if (this.checked) {
                fields.classList.remove('hidden');
                btn.classList.add('selected');
            } else {
                fields.classList.add('hidden');
                btn.classList.remove('selected');
            }    
        });
    });
</script>
<%- include('../partials/footer') %>