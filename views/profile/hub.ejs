<%- include ('../partials/header') %>
<main class="page container">
    <div class="page-header">
        <h1>Artist Hub</h1>
    </div>

    <div class="card Hub-card">
        <form action="/hub?_method=PUT" method="POST">

            <section class="form-section">
                <h2 class="section-heading">The Deets</h2>

                <div class="form-group">
                    <label for="displayName">Artist Name</label>
                    <input type="text" id="displayName" name="displayName" value="<%=user.displayName || '' %>" placeholder="name">
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" value="<%=user.email %>" disabled>
                    <span class="form-hint">For security purposes this email cannot be changed</span>
                </div>
            </section>

            <section class="form-section">
                <h2 class="section-heading">Roles</h2>
                <p class="section-description">Select all that apply</p>

                    <div class="role-btns"><% Object.entries(ROLES).forEach(([key,role]) => { %>
                        <% const isChecked = user.roles && user.roles.includes(key); %>
                        <label class="role-checkbox">
                            <input type="checkbox" name="roles" value="<%=key %>" <%= isChecked ? 'checked' : '' %>>
                            <span class="role-btn <%= isChecked ? 'selected' : '' %>">
                                <%= role.icon %> <%= role.label %>
                            </span>
                        </label>
                        <% }) %>
                    </div>
            </section>

            <div class="role-fields role-fields-artist <%= user.roles && user.roles.includes('artist') ? '' : 'hidden' %>" id="artist-fields">
                <h3>üé§ Artist Deets</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for ="stageName">Stage Name</label>
                        <input type="text" id="stageName" name="stageName" value="<%= user.stageName || '' %>">
                </div>
                <div class="form-group">
                    <label for="genre">Genre</label>
                    <input type="text" id="genre" name="genre" value="<%= user.genre || '' %>">
                    </div>
                </div>
            </div>

            <div class="role-fields role-fields-producer <%= user.roles && user.roles.includes('producer') ? '' : 'hidden' %>" id="producer-fields">
            <h3>üéõÔ∏è Producer Deets</h3>
            <div class="form-row">
                <label for="producerTag">Producer Tag</label>
                <input type="text" id="producerTag" name="producerTag" value="<%= user.producerTag || '' %>">
            </div>
            <div class="form-group">
                <label for="daw">DAW</label>
                <select id="daw" name="daw">
                    <option value=""> SELECT DAW</option>
                    <% DAW_OPTIONS.forEach(d => { %>
                        <option value="<%= d %>" <%= user.daw === d ? 'selected' : '' %>><%= d %></option>
                        <% }) %>
                </select>
            </div>
        </div>
    </div>

        <div class="role-fields role-fields-writer <%= user.roles && user.roles.includes('writer') ? '' : 'hidden' %>" id="writer-fields">
            <h3>‚úçÔ∏è Writer Info</h3>
            <div class="form-row">
                <div class="form-group">
                    <label for="writerPro">PRO</label>
                    <select id="writerPro" name="writerPro">
                        <option value="">Select PRO</option>
                        <% PRO_OPTIONS.forEach(p => { %>
                            <option value="<%= p %>" <%= user.writerPro === p ? 'selected' : '' %>><%= p %></option>
                        <% }) %>
                    </select>
                </div>
                <div class="form-group">
                    <label for="writerIpi"> IPI Number</label>
                    <input type="text" id="writerIpi" name="writerIpi" value="<%= user.writerIpi || '' %>">
                </div>
            </div>
        </div>
        <div class="role-fields role-fields-publisher <%= user.roles && user.roles.includes('publisher') ? '' : 'hidden' %>" id="publisher-fields">
            <h3>üìÑ Publisher Deets</h3>
            <div class="form-group">
                <label for="publishingCompany">Publishing Company</label>
                <input type="text" id="publishingCompany" name="publishingCompany" value="<%=user.publishingCompany || '' %>">
            </div>
            <div class="form-row">
            <div class="form-group">
                <label for="publisherPro">Publisher PRO</label>
                <select id="publisherPro" name="publisherPro">
                    <option value="">Select PRO</option>
                    <% PRO_OPTIONS.forEach(p => { %>
                        <option value="<%= p %>" <%= user.publisherPro === p ? 'selected' : '' %>><%= p %></option>
                    <% }) %>
                </select>
            </div>
          </div>
          <div class="form-group">
            <label for="publisherIpi">Publisher IPI</label>
            <input type="text" id="publisherIpi" name="publisherIpi" value="<%= user.publisherIpi || '' %>">
            </div>
          </div>

        <button type="submit" class="btn btn-primary btn-large btn-save">Save Deets</button>
        </form>
    </div>
</main>
<script> document.querySelectorAll('.role-checkbox input').forEach(checkbox => { checkbox.addEventListener('change', function() {
    const role = this.value;
    const fields = document.querySelector('.role-fields' + role);
    const btn = this.nextElementSibling;
    if (this.checked) {
        fields.classList.remove('hidden');
        btn.classList.add('selected');
    } else {
        fields.classList.add('hidden');
        btn.classList.remove('selected');
    }
  });
});
</script>

    <%- include('../partials/footer') %>